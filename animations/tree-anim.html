<html>
  <head>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene background="color: #000">
      <a-assets>
        <a-asset-item id="treeModel" src="main_tree.glb"></a-asset-item>
      </a-assets>

      <!-- Ð´ÐµÑ€ÐµÐ²Ð¾ -->
      <a-entity id="tree" gltf-model="#treeModel" position="0 0 -5"></a-entity>

      <script>
        AFRAME.registerComponent("rune-glow", {
          init: function () {
            this.time = 0;
            this.targetNodes = [];

            this.el.addEventListener("model-loaded", () => {
              const model = this.el.getObject3D("mesh");
              if (!model) return;

              // Ð˜Ð¼ÐµÐ½Ð° Ñ€ÑƒÐ½
              const runeNames = ["Object_8002", "Object_28001", "Object_46001", "Object_50001"];

              model.traverse((node) => {
                if (node.isMesh && runeNames.includes(node.name)) {
                  console.log("Ð ÑƒÐ½Ð° Ð½Ð°Ð¹Ð´ÐµÐ½Ð°:", node.name);

                  node.material = node.material.clone();
                  node.material.emissive = new THREE.Color(0x00ffff); // Ð³Ð¾Ð»ÑƒÐ±Ð¾Ð¹
                  node.material.emissiveIntensity = 2.5; // ðŸ”¥ ÑÐ¸Ð»ÑŒÐ½ÐµÐµ ÑÐ²ÐµÑ‚Ð¸Ñ‚ÑÑ
                  node.material.roughness = 0.2;
                  node.material.metalness = 0.1;

                  this.targetNodes.push(node);
                }
              });
            });
          },

          tick: function (time, deltaTime) {
            if (!this.targetNodes.length) return;
            this.time += deltaTime / 1000;

            // ðŸ”¹ ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ð»Ð°Ð²Ð½Ñ‹Ð¹ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ Ð³Ð¾Ð»ÑƒÐ±Ð¾Ð¹ â†” Ð±ÐµÐ»Ñ‹Ð¹
            const t = (Math.sin(this.time * 2.0) + 1) / 2; // 0 â†’ 1 â†’ 0
            const color = new THREE.Color(0x00ffff).lerp(new THREE.Color(0xffffff), t);
            const brightness = 2.0 + Math.sin(this.time * 2.0) * 1.0; // Ð´Ñ‹Ñ…Ð°Ð½Ð¸Ðµ ÑÑ€ÐºÐ¾ÑÑ‚Ð¸

            this.targetNodes.forEach((node) => {
              node.material.emissive.copy(color);
              node.material.emissiveIntensity = brightness;
              node.material.needsUpdate = true;
            });
          }
        });

        // Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÑÐµÐ¼ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚ Ðº Ð´ÐµÑ€ÐµÐ²Ñƒ
        document.querySelector("#tree").setAttribute("rune-glow", "");

        // Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ð¼ Ð²ÑÐµ Ð¼ÐµÑˆÐ¸ Ð² ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒ
        document.querySelector('#tree').addEventListener('model-loaded', (e) => {
          const model = e.detail.model;
          console.log('ÐœÐ¾Ð´ÐµÐ»ÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð°! Ð’ÑÐµ Ð¼ÐµÑˆÐ¸:');
          model.traverse((node) => {
            if (node.isMesh) {
              console.log('Mesh name:', node.name);
            }
          });
        });
      </script>
    </a-scene>
  </body>
</html>


