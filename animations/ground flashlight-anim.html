<html>
  <head>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene background="color: #011">
      <a-assets>
        <a-asset-item id="flashlightModel" src="ground_flashlight.glb"></a-asset-item>
      </a-assets>

      <!-- —Ñ–æ–Ω–∞—Ä–∏–∫ -->
<a-entity id="flashlight" position="0 0 -3" rotation="0 0 0">
  <a-entity gltf-model="#flashlightModel" scale="2 2 2"></a-entity>

  <!-- –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–≤–µ—Ç–∞ -->
  <a-entity
    id="light-source"
    light="type: spot; color: #fff7cc; intensity: 0; distance: 10; angle: 25; penumbra: 0.5"
    position="0 0 0.15"
    rotation="-10 0 0"
  ></a-entity>
</a-entity>


      <script>
        AFRAME.registerComponent("flashlight-blink", {
          init: function () {
            this.targetNodes = [];
            this.isOn = false;
            this.timer = 0;
            this.nextBlink = 0;
            this.light = this.el.querySelector("#light-source");

            const modelEntity = this.el.querySelector("[gltf-model]");

            modelEntity.addEventListener("model-loaded", (e) => {
              const model = e.detail.model;
              if (!model) return;

              console.log("–ú–æ–¥–µ–ª—å —Ñ–æ–Ω–∞—Ä–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞! –°–ø–∏—Å–æ–∫ –º–µ—à–µ–π:");
              model.traverse((node) => {
                if (node.isMesh) {
                  console.log("Mesh name:", node.name);
                  node.material = node.material.clone();
                  node.material.emissive = new THREE.Color(0xfff6aa); // —Ç—ë–ø–ª—ã–π —Å–≤–µ—Ç
                  node.material.emissiveIntensity = 0;
                  this.targetNodes.push(node);
                }
              });

              // –Ω–∞–∑–Ω–∞—á–∞–µ–º –ø–µ—Ä–≤—ã–π –º–æ–º–µ–Ω—Ç –º–∏–≥–∞–Ω–∏—è
              this.nextBlink = this.getRandomBlinkTime();
            });
          },

          getRandomBlinkTime: function () {
            // –≤—Ä–µ–º—è –º–µ–∂–¥—É –º–∏–≥–∞–Ω–∏—è–º–∏ 1‚Äì4 —Å–µ–∫—É–Ω–¥—ã
            return 1000 + Math.random() * 3000;
          },

          tick: function (time, deltaTime) {
            if (!this.targetNodes.length) return;

            this.timer += deltaTime;
            if (this.timer >= this.nextBlink) {
              this.isOn = !this.isOn;
              const intensity = this.isOn ? 3.0 : 0.0;
              const lightIntensity = this.isOn ? 2.5 : 0.0;

              // –æ–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª
              this.targetNodes.forEach((node) => {
                node.material.emissiveIntensity = intensity;
                node.material.needsUpdate = true;
              });

              // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–≤–µ—Ç
              if (this.light) {
                this.light.setAttribute("light", "intensity", lightIntensity);
              }

              console.log("üí° –§–æ–Ω–∞—Ä–∏–∫", this.isOn ? "–≤–∫–ª—é—á–∏–ª—Å—è" : "–ø–æ–≥–∞—Å");

              // —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –∏ –Ω–∞–∑–Ω–∞—á–∞–µ–º —Å–ª–µ–¥—É—é—â–µ–µ –º–∏–≥–∞–Ω–∏–µ
              this.timer = 0;
              this.nextBlink = this.getRandomBlinkTime();
            }
          },
        });

        // –ø—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–æ –≤—Å–µ–º—É –æ–±—ä–µ–∫—Ç—É —Ñ–æ–Ω–∞—Ä—è
        document.querySelector("#flashlight").setAttribute("flashlight-blink", "");
      </script>
    </a-scene>
  </body>
</html>


